

# Bachelor project

## Description
A simple API build with NestJS and gRPC.
## Components
Contains 2 seperate programs:
 - The API in the api folder
 - A performance and integration test client written in the dart programming language
## Test Setup
### Running the Tests
The api has Dockerfile and is build to be containerized. Likewise, the test client has a Dockerfile and is build to run in the same setup as the API container. In the root folder you can find a docker-compose file. This will setup a single API container, a test container, and a MongoDB container. The Test container needs to be started with a delay after the API container. To ensure this, you will also find two test scripts in the root folder. Running either of these will ensure correct startup of the docker-compose file. It has also build in teardown of the volumes in the top of the file for a clean test.

### Selecting the Tests
The test client has 3 test files. The test file you want to run can be selected by uncommenting it in the test\lib\client.dart file. 
### Tweaking the Performance Test
The performance test is setup to generate x number of clients which will each connect to the running service on their own http/2 connection. Each client will send y number of messages to the api with a time interval between 500 and 1500 milliseconds. The test can easily be modified with the number of clients, number of messages sent, and the number of iterations which should be run. The attributes can be set in the test\lib\client.dart file.
## Code Generation
THe code relies on autogenerated code from the proto files located in both the root folder, api folder and test folder. 
To generate the code for the test client run the following command withing the test folder:
 - protoc --dart_out=grpc:lib/generated_proto -I../ hero.proto

 To generate the code for the api run the following command within the api folder:
 - **Linux:**    protoc --plugin=node_modules/ts-proto/protoc-gen-ts_proto --ts_proto_out=./generated_proto hero.proto -I. --ts_proto_opt=nestJs=true --ts_proto_opt=addGrpcMetadata=true
 - **Windows:** protoc --plugin=protoc-gen-ts_proto=.\node_modules\.bin\protoc-gen-ts_proto.cmd --ts_proto_out=.\generated_proto hero.proto -I../ --ts_proto_opt=nestJs=true --ts_proto_opt=addGrpcMetadata=true